name: "Staged dependencies action"
description: "Github Actions to implement R development stages for package development"
inputs:
  staged-dependencies-version:
    description: "Version of staged.dependencies"
    required: true
    default: "v0.2.2"
  path:
    description: "Path to R package"
    required: true
    default: "."
## Add consistency check
runs:
  using: "composite"
  steps:
      - name: Install dependencies
        run: |
          options(repos = c(CRAN = "https://cloud.r-project.org/"))
          ncores <- parallel::detectCores(all.tests = FALSE, logical = TRUE)
          cat(paste("\n\nnumber of cores detected:", ncores, "\n\n"))
          if (!require("remotes")) install.packages("remotes", upgrade = "never", Ncpus = ncores)
          if (!require("optparse")) install.packages("optparse", upgrade = "never", Ncpus = ncores)
        shell: Rscript {0}

      - name: Run system dependencies
        run: >-
          ${GITHUB_ACTION_PATH}/system-dependencies.R
          --repo_path "${{ inputs.path }}"
        shell: sh

      - name: Run staged dependencies
        run: >-
          ${GITHUB_ACTION_PATH}/staged-dependencies.R
          --repo_path "${{ inputs.path }}"
          --staged_version "${{ inputs.staged-dependencies-version }}"
          --git_ref "${{ github.ref }}"
          --check
        shell: sh

